<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mina Data</title>
    <link rel="stylesheet" href="styles.css">
    <script src="minaData.js"></script>
</head>
<body>
    <label for="presets">Choose a preset</label>
    <select id="presets">
    </select>
    <form id="hashForm">
        <!-- Input-Feld fÃ¼r den Hash-Wert -->
        <br><br>
        
        <!-- Submit-Button -->
        <input type="submit" value="Submit">
    </form>

    <h1>Events</h1>
    <div class="table-container">
        <table id="myTable">
            <thead>
            <tr>
                <th>EventId</th>
                <th>Preset</th>
                <th>Status</th>
                <th>Data</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <script>

        class UserInterface {
            #config


            constructor() {
                this.#config = {}
            }


            init() {
                this.#addUserInterface()
                this.#addForm( { 'key': 'transactionByHash'} )
                this.#addSubmitButton()
                return true
            }


            #addForm( { key } ) {
                const preset = minaData.getPreset( { key } )
                const form = document.getElementById( 'hashForm' )
                form.innerHTML = ''
                Object
                    .entries( preset['input']['variables'] )
                    .forEach( ( a, index ) => {
                        const [ key, value ] = a
                        const label = document.createElement( 'label' )
                        label.setAttribute( 'for', key )
                        label.textContent = `${key}: `
                        const inputElement = document.createElement( 'input' )
                        const tmp = [ 
                            [ 'type', 'text'], [ 'id', key ], 
                            [ 'name', key ], [ 'value', value['default'] ], 
                            [ 'required', true ], /*[ 'pattern', value['regex']*/
                        ]
                            .forEach( a => inputElement[ a[ 0 ] ] = a[ 1 ] )
                        const lineBreak = document.createElement( 'br' )
                        form.appendChild( label)
                        form.appendChild( inputElement)
                        form.appendChild( lineBreak )
                        form.appendChild( lineBreak )
                    } )
                
                const ipt = document.createElement( 'input' )
                ipt.type = 'submit'
                ipt.value = 'SUBMIT'
                form.appendChild( ipt )
            }


            #addUserInterface() {
                const presets = document.getElementById( 'presets' )
                minaData
                    .getPresets()
                    .forEach( a => {
                        const element = document.createElement( 'option' )
                        element.innerHTML = a
                        presets.appendChild( element )
                    } )

                presets
                    .addEventListener(
                        'change',
                        ( e ) => {
                            const key = document.getElementById( 'presets' ).value
                            this.#addForm( { key } )
                        }
                    )
            }


            #addSubmitButton() {
                var form = document.getElementById( 'hashForm' )
                form.addEventListener(
                    'submit', 
                    ( event ) => {
                        // Prevent the default form submission behavior, which would reload the page
                        event.preventDefault()

                        var textInputs = form.querySelectorAll( 'input[type="text"]' )
                        const userVars = {}
                        textInputs
                            .forEach( 
                                ( input, index ) => { 
                                    userVars[ input.id ] = input.value 
                                }
                            )

                        const selectElement = document.getElementById( 'presets' )
                        const key = selectElement.options[ selectElement.selectedIndex ].value

                        minaData.getData( { 'preset': key, userVars } )
                } )
            }


            addEventRow( { columns } ) {
                var newRow = document.createElement( 'tr' )
                Object
                    .entries( columns )
                    .forEach( ( a ) => {
                        const [ key, value ] = a
                        const cell = document.createElement( 'td' )
                        cell.textContent = value
                        newRow.appendChild( cell )
                    } )

                const table = document.getElementById( 'myTable' )

                const firstRow = table.querySelector('tbody tr:first-child')
                table.querySelector('tbody').insertBefore(newRow, firstRow);

                //table.appendChild( newRow )
            }
        }

        let debug = true
        var minaData = new MinaData( debug )
        minaData.init( {
            'chain': 'berkeley'
        } )

        const userInterface = new UserInterface()
        userInterface.init()

        minaData.addEventListener(
                'status', 
                ( event ) => { 
                    userInterface.addEventRow( { 'columns': event.detail } )
                }
            )

    </script>
</body>
</html>
